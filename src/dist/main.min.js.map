{"version":3,"sources":["main.js"],"names":["_vue","_interopRequireDefault","require","_App","_router","_elementUi","_axios","Vue","use","Element","size","zIndex","prototype","axios","config","productionTip","window","stateManage","genId","type","STATE_NAME_POOL","store","threadAry","_id","width","height","stateAry","lineAry","debug","obj","statenameIndex","push","data","stateType","name","stateData","this","stateId","inputAry","outputAry","parent","mode","getDefaultStateCfg","y","index","state","children","threadIndex","lineData","relateLine2startState","addState","deleteLine","line","i","relateLine2endState","lineId","splice","traverseLine","lineState","lineItem","result","startState","pop","forEach","item","endState","traverse","stateIndex","resizeThread","dh","dw","isThreadId","thread","find","id","threadIdOrIndex","getStateImplement","error","_this","length","router","beforeEach","to","from","next","console","log","EventObj","el","components","App","template"],"mappings":"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","file":"main.min.js","sourcesContent":["// The Vue build version to load with the `import` command\r\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\r\nimport Vue from 'vue'\r\nimport App from './App'\r\nimport router from './router'\r\nimport Element from 'element-ui';\r\nimport 'element-ui/lib/theme-chalk/index.css';\r\nimport axios from 'axios';\r\n\r\nVue.use(Element, { size: 'small', zIndex: 3000 });\r\nVue.prototype.axios = axios;\r\n\r\nVue.config.productionTip = false\r\n\r\nwindow.stateManage = {};//状态管理  后续采用vuex实现 TODO\r\nwindow.genId = (function () {\r\n  var _id = 0;\r\n  return function (type) {\r\n    return type + '-' + +new Date();//+ ++_id\r\n  }\r\n})();\r\nconst STATE_NAME_POOL = [\"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"H\", \"I\", \"J\", \"K\", \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\", \"Y\", \"Z\"];\r\nwindow.store = {\r\n  debug: true,\r\n  statenameIndex: 0,\r\n  stateData: {\r\n    threadAry: [\r\n      {\r\n        name: \"Main_thread\",\r\n        width: 1200,\r\n        height: 500,\r\n        stateAry: [],\r\n        lineAry: [],\r\n      },\r\n    ],\r\n  },\r\n  addThread(obj) {\r\n    this.stateData.threadAry.push(obj);\r\n  },\r\n  /**\r\n  * 获取状态组件的默认配置\r\n  * @param {index: this.threadIndex, x: e.x - threadPosInfo.x, y: e.y - threadPosInfo.y, stateType: e.dataTransfer.getData(\"stateType\")} data\r\n  */\r\n  getDefaultStateCfg(data) {\r\n    return {\r\n      width: data.stateType === \"loopDiv\" ? \"300px\" : \"76px\",\r\n      height: data.stateType === \"loopDiv\" ? \"120px\" : \"40px\",\r\n      // name: \"状态描述\" + this.statenameIndex++,\r\n      name: STATE_NAME_POOL[this.statenameIndex++],\r\n      stateType: data.stateType,\r\n      stateId: window.genId(\"state\"),\r\n      inputAry: [],\r\n      outputAry: [],\r\n      parent: null,\r\n      mode:'normal',\r\n      x: data.x,\r\n      y: data.y,\r\n      children:[],\r\n    }\r\n  },\r\n  addState(data) {\r\n    let state = this.getDefaultStateCfg(data);\r\n    this.stateData.threadAry[data.index].stateAry.push(state);\r\n  },\r\n  /**\r\n   * 在线程框内增加连线\r\n   * @param { threadIndex, lineData }data\r\n   */\r\n  addLine(data) {\r\n    this.stateData.threadAry[data.threadIndex].lineAry.push(data.lineData);\r\n    //将连线数据添加到首尾2个状态块\r\n    this.relateLine2startState(data);\r\n    this.relateLine2endState(data);\r\n  },\r\n  /**\r\n   * 删除连线 \r\n   * 参数：连线id， 线程索引（TODO:后续考虑修改为线程id）\r\n   * @param {lineId, threadIndex} data\r\n   */\r\n  deleteLine(data) {\r\n    let lineAry = this.stateData.threadAry[data.threadIndex].lineAry,\r\n      lineItem,\r\n      line,\r\n      i;\r\n    for (i = 0; i < lineAry.length; i++) {\r\n      lineItem = lineAry[i];\r\n      if (lineItem.lineId === data.lineId) {\r\n        line = lineAry.splice(i, 1)[0];\r\n        break;\r\n      }\r\n    }\r\n    //修改为深度搜索与选中连线相关的状态\r\n    function traverseLine(stateAry, lineState) {\r\n      for (var i in stateAry){\r\n          if (stateAry[i].stateId === lineState.stateId){\r\n          result.push(stateAry[i]);\r\n          return\r\n          }\r\n        traverseLine(stateAry[i].children, lineState);\r\n      } \r\n    };\r\n    let result = [];\r\n    //更新这条线的始末状态的outputAry inputAry信息\r\n    let stateAry = this.stateData.threadAry[data.threadIndex].stateAry;\r\n    traverseLine(stateAry, line.startState)\r\n    let startState = result.pop()\r\n    let outputAry = startState.outputAry;\r\n    outputAry.forEach((item, index) => {\r\n      if (item.lineId === line.lineId) {\r\n        outputAry.splice(index, 1);\r\n        return false;\r\n      }\r\n    });\r\n\r\n    traverseLine(stateAry, line.endState)\r\n    let endState = result.pop()\r\n    let inputAry = endState.inputAry;\r\n    inputAry.forEach((item, index) => {\r\n      if (item.lineId === line.lineId) {\r\n        inputAry.splice(index, 1);\r\n        return false;\r\n      }\r\n    });\r\n  },\r\n  /**\r\n   * 将连线数据和连线的首尾2个状态关联\r\n   * @param  { threadIndex, lineData }data\r\n   */\r\n\r\n  relateLine2startState(data) {\r\n    let result = []\r\n    // 用于深度搜索stateId的方法，寻找到的state存储在result内\r\n    function traverse(stateAry) {\r\n      for (var i in stateAry){\r\n        if (stateAry[i].stateId === data.lineData.startState.stateId){\r\n          result.push(stateAry[i]);\r\n          return\r\n        }\r\n        traverse(stateAry[i].children);\r\n      }\r\n    };\r\n\r\n    if (data.lineData.startState) {\r\n      traverse(this.stateData.threadAry[data.threadIndex].stateAry)\r\n      let outputAry = result[0].outputAry;\r\n      if (!outputAry) {\r\n        outputAry = [];\r\n        result[0].outputAry = outputAry;\r\n      }\r\n      outputAry.push({\r\n        lineId: data.lineData.lineId, //这里只存放连线的lineId，对连线的具体数据只保存一份，放在thread.lineAry里面，避免维护多份数据\r\n      });\r\n    }\r\n  },\r\n  /**\r\n   * \r\n   * \r\n   * \r\n   */\r\n  relateLine2endState(data) {\r\n    if (\r\n      data.lineData.endState &&\r\n      data.lineData.endState.stateIndex !== null\r\n    ) {\r\n      // 根据id来拿\r\n      let result = []\r\n      // 用于深度搜索stateId的方法，寻找到的state存储在result内\r\n      function traverse(stateAry) {\r\n        for (var i in stateAry){\r\n          if (stateAry[i].stateId === data.lineData.endState.stateId){\r\n            result.push(stateAry[i]);\r\n            return\r\n          }\r\n          traverse(stateAry[i].children);\r\n        }\r\n      };\r\n      traverse(this.stateData.threadAry[data.threadIndex].stateAry)\r\n      let inputAry = result[0].inputAry;\r\n      \r\n      if (!inputAry) {\r\n        inputAry = [];\r\n        result[0].inputAry = inputAry;\r\n      }\r\n      inputAry.push({\r\n        lineId: data.lineData.lineId,\r\n      });\r\n    }\r\n  },\r\n  /**\r\n   * 调整线程框的宽高\r\n   * @param {dw, dh} data \r\n   */\r\n  resizeThread(data) {\r\n    if (data.dh) {\r\n      this.stateData.threadAry[data.threadIndex].height += data.dh;\r\n    }\r\n    if (data.dw) {\r\n      this.stateData.threadAry[data.threadIndex].width += data.dw;\r\n    }\r\n  },\r\n  /**\r\n   * 根据传入的线程id/index + 状态id获取状态\r\n   * @param {*} threadIdOrIndex\r\n   * @param {*} stateId \r\n   * @param {*} isThreadId 是否是线程id\r\n   */\r\n  getState(threadIdOrIndex, stateId, isThreadId){\r\n    let state;\r\n    let thread;\r\n    if (isThreadId){\r\n      thread = this.stateData.threadAry.find(item => {\r\n        return item.id === threadIdOrIndex;\r\n      });\r\n    }else{\r\n      thread = this.stateData.threadAry[threadIdOrIndex];\r\n    }\r\n    if (thread){\r\n      state = this.getStateImplement(stateId, thread.stateAry);\r\n    }\r\n    if(!state){\r\n      console.error('根据threadIdOrIndex和stateId获取状态失败---> threadId: ' + threadIdOrIndex + ' stateId: ' + stateId + ' isThreadId: ' + isThreadId);\r\n    }\r\n    return state;\r\n  },\r\n  getStateImplement(stateId, stateAry){\r\n    let state;\r\n    stateAry.forEach(item => {\r\n      if (item.stateId === stateId) {\r\n        state = item;\r\n        return false;\r\n      } else if (item.children && item.children.length) {\r\n        state = this.getStateImplement(stateId, item.children);\r\n      }\r\n    });\r\n    return state;\r\n  }\r\n}\r\n\r\nrouter.beforeEach((to, from, next)=>{\r\n  console.log(to);\r\n  if ((from.name === 'blockly' && to.name === 'state') || (to.name === 'blockly' && from.name === 'state')){\r\n    console.log('同步数据... '); //TODO\r\n  }\r\n  next();\r\n})\r\n/* eslint-disable no-new */\r\nwindow.EventObj = new Vue();\r\nnew Vue({\r\n  el: '#app',\r\n  router,\r\n  components: { App },\r\n  template: '<App/>'\r\n})\r\n"]}